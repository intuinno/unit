"use strict";angular.module("unitApp",["ngAnimate","ngCookies","ngResource","ngRoute","ngSanitize","ngTouch"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl",controllerAs:"main"}).when("/example",{templateUrl:"views/example.html",controller:"ExampleCtrl",controllerAs:"example"}).when("/example",{templateUrl:"views/example.html",controller:"ExampleCtrl",controllerAs:"example"}).when("/live",{templateUrl:"views/live.html",controller:"LiveCtrl",controllerAs:"live"}).when("/enum",{templateUrl:"views/enum.html",controller:"EnumCtrl",controllerAs:"enum"}).otherwise({redirectTo:"/"})}]),angular.module("unitApp").controller("MainCtrl",function(){this.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}),angular.module("unitApp").controller("AboutCtrl",function(){this.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}),angular.module("unitApp").controller("ExampleCtrl",["unit",function(a){var b=a.UnitChart;d3.json("./data/unit_column_chart_shared.json",function(a,c){b("unit_column_chart_shared",c)}),d3.json("./data/unit_column_chart.json",function(a,c){b("unit_column_chart",c)}),d3.json("./data/unit_column_chart_shared_mark.json",function(a,c){b("unit_column_chart_shared_mark",c)}),d3.json("./data/horizontal_unit_column.json",function(a,c){b("horizontal_unit_column",c)}),d3.json("./data/titanic_spec_packxy_hierarchy.json",function(a,c){b("packxy_hierarchy",c)}),d3.json("./data/titanic_spec_packxy_isolated.json",function(a,c){b("packxy_isolated",c)}),d3.json("./data/titanic_spec4.json",function(a,c){b("packxy2",c)}),d3.json("./data/titanic_spec_packxy_mixed.json",function(a,c){b("packxy_mixed",c)}),d3.json("./data/square_aspect.json",function(a,c){b("square_aspect",c)}),d3.json("./data/maxfill_aspect.json",function(a,c){b("maxfill_aspect",c)}),d3.json("./data/unit_small_multiple.json",function(a,c){b("unit_small_multiple",c)}),d3.json("./data/size_uniform_notShared.json",function(a,c){b("size_uniform_notshared",c)}),d3.json("./data/size_sum_notShared.json",function(a,c){b("size_sum_notshared",c)}),d3.json("./data/size_uniform_shared.json",function(a,c){b("size_uniform_shared",c)}),d3.json("./data/size_sum_shared.json",function(a,c){b("size_sum_shared",c)}),d3.json("./data/violin.json",function(a,c){b("violin",c)}),d3.json("./data/fluctuation.json",function(a,c){b("fluctuation",c)}),d3.json("./data/mosaic.json",function(a,c){b("mosaic",c)})}]),angular.module("unitApp").factory("unit",function(){function a(a,c){var d,e=[],f=Q(a[0],c,"size");return a.forEach(function(a,h,i){d=Q(a,c,"size");var j=L(a,c);j.length>0&&g(a,j,c),a.contents=j,b(a,c),e=e.concat(j),d!==f&&(E(c),f=d)}),E(c),e}function b(a,b){b.size.isShared&&(b.hasOwnProperty("sizeSharingGroup")||(b.sizeSharingGroup=[]),b.sizeSharingGroup=b.sizeSharingGroup.concat(a.contents))}function c(a,b){var c={};return c.contents=a,c.label="root",b.hasOwnProperty("padding")||(b.padding={top:10,left:30,bottom:30,right:10}),c.visualspace={width:b.width,height:b.height,posX:0,posY:0,padding:b.padding},c.layout="StartOfLayout",c.parent="RootContainer",c}function d(a,b){var c={};return c.head=a[0],a.forEach(function(a,b,c){b>0?a.parent=c[b-1]:a.parent="StartOfLayout",b<c.length-1?a.child=c[b+1]:a.child="EndOfLayout"}),c}function e(a,b){var c=d3.nest().key(function(a){return a[b]}).entries(a);return c.map(function(a){return a.key})}function f(a,b){return e(a,b).map(function(a){return{contents:[],label:a,visualspace:{}}})}function g(a,b,c){switch(c.containers=b,c.type){case"gridxy":h(a,b,c);break;default:console.log("Unsupported Layout type")}}function h(a,b,c){switch(c.aspect_ratio){case"fillX":case"fillY":l(a,b,c);break;case"square":case"parent":case"custom":r(a,b,c);break;case"maxfill":i(a,b,c)}}function i(a,b,c){var d=j(a,b,c);u(a,b,c,d)}function j(a,b,c){var d=k(b.length),e=d.map(function(b){return{width:a.visualspace.width/b.a,height:a.visualspace.height/b.b,horizontalRepetitionCount:b.a,verticalRepetitionCount:b.b}});e.forEach(function(a){a.minEdge=a.width>a.height?a.height:a.width});var f=d3.scan(e,function(a,b){return b.minEdge-a.minEdge}),g=e[f];return D(g.horizontalRepetitionCount,g.verticalRepetitionCount,g.width,g.height,c)}function k(a){var b=d3.range(1,a+1);return b=b.map(function(b){return{a:b,b:Math.ceil(a/b)}})}function l(a,b,c){var d=J(a,c),e=p(d,b,c);m(a,b,c,e)}function m(a,b,c,d){var e=a.visualspace;if("fillX"===c.aspect_ratio){var f=d;b.forEach(function(a,b,d){a.visualspace.width=f*q(a,c)-c.margin.left-c.margin.right,a.visualspace.height=e.height-e.padding.top-e.padding.bottom-c.margin.top-c.margin.bottom,a.visualspace.posY=e.padding.top+c.margin.top,a.visualspace.padding=c.padding}),n(e,c,b)}else if("fillY"===c.aspect_ratio){var g=d;b.forEach(function(a,b,d){a.visualspace.height=g*q(a,c)-c.margin.top-c.margin.bottom,a.visualspace.width=e.width-e.padding.left-e.padding.right-c.margin.left-c.margin.right,a.visualspace.posX=e.padding.left+c.margin.left,a.visualspace.padding=c.padding}),o(e,c,b)}else console.log("TODO")}function n(a,b,c){var d,e,f;switch(b.direction){case"LRTB":case"LRBT":case"TBLR":case"BTLR":case"LR":d=0,e=1;break;case"RLBT":case"RLTB":case"BTRL":case"TBRL":case"RL":d=c.length-1,e=-1;break;default:console.log("Unsupported Layout Direction",b)}var g=d3.sum(c,function(a){return a.visualspace.width+b.margin.left+b.margin.right});switch(b.align){case"left":case"LT":case"LM":case"LB":f=a.padding.left;break;case"center":case"CT":case"CM":case"CB":f=a.padding.left+(a.width-a.padding.left-a.padding.right)/2-g/2;break;case"right":case"RT":case"RM":case"RB":f=a.width-a.padding.right-g}c.forEach(function(a,c,g){var h=d+e*c;0===c?g[h].visualspace.posX=f+b.margin.left:g[h].visualspace.posX=g[h-e].visualspace.posX+g[h-e].visualspace.width+b.margin.right+b.margin.left})}function o(a,b,c){var d,e,f;switch(b.direction){case"LRTB":case"RLTB":case"TBLR":case"TBRL":case"TB":d=0,e=1;break;case"LRBT":case"RLBT":case"BTLR":case"BTRL":case"BT":d=c.length-1,e=-1;break;default:console.log("Unsupported Layout Direction",b)}var g=d3.sum(c,function(a){return a.visualspace.height+b.margin.top+b.margin.bottom});switch(b.align){case"top":case"RT":case"CT":case"LT":f=a.padding.top;break;case"middle":case"LM":case"RM":case"CM":f=a.padding.top+(a.height-a.padding.top-a.padding.bottom)/2-g/2;break;case"bottom":case"LB":case"CB":case"RB":f=a.height-a.padding.bottom-g}c.forEach(function(a,c,g){var h=d+e*c;0===c?g[h].visualspace.posY=f+b.margin.top:g[h].visualspace.posY=g[h-e].visualspace.posY+g[h-e].visualspace.height+b.margin.bottom+b.margin.top})}function p(a,b,c){var d=d3.sum(b,function(a){return q(a,c)});return a/d}function q(a,b){switch(b.size.type){case"uniform":return 1;case"sum":return d3.sum(a.contents,function(a){return a[b.size.key]});case"count":return a.contents.length}}function r(a,b,c){var d;switch(c.aspect_ratio){case"square":d=1;break;case"parent":d=a.visualspace.width/a.visualspace.height}var e=s(a,b,c,d);u(a,b,c,e)}function s(a,b,c,d){if(y(c.direction))var e=x(a.visualspace.width,a.visualspace.height,b.length,d);else var e=x(a.visualspace.height,a.visualspace.width,b.length,1/d);return e}function t(a,b,c,d){switch(c.aspect_ratio){case"square":b.forEach(function(b,e,f){b.visualspace.width=Math.sqrt(d*q(b,c)),b.visualspace.height=Math.sqrt(d*q(b,c)),b.visualspace.posX=a.visualspace.padding.left+c.margin.left+.5*(a.visualspace.width-b.visualspace.width-a.visualspace.padding.left-a.visualspace.padding.right),b.visualspace.posY=a.visualspace.padding.top+c.margin.top+.5*(a.visualspace.height-b.visualspace.height-a.visualspace.padding.top-a.visualspace.padding.right)})}}function u(a,b,c,d){y(c.direction)?w(a,b,c,d):v(a,b,c,d)}function v(a,b,c,d){var e,f,g,h,i;switch(c.direction){case"TBLR":e=0,f=0,g=d.remainingEdgeSideUnitLength,h=d.fillingEdgeSideUnitLength,i=d.fillingEdgeRepetitionCount;break;case"BTLR":e=0,f=a.visualspace.height-d.remainingEdgeSideUnitLength,g=d.remainingEdgeSideUnitLength,h=-1*d.fillingEdgeSideUnitLength,i=d.fillingEdgeRepetitionCount;break;case"TBRL":case"BTRL":console.log("TODO")}b.forEach(function(a,b,j){a.visualspace.width=d.remainingEdgeSideUnitLength,a.visualspace.height=d.fillingEdgeSideUnitLength,a.visualspace.posX=e+g*Math.floor(b/i),a.visualspace.posY=f+h*(b%i),a.visualspace.padding=c.padding})}function w(a,b,c,d){var e,f,g,h,i;switch(c.direction){case"LRTB":e=0,f=0,g=d.fillingEdgeSideUnitLength,h=d.remainingEdgeSideUnitLength,i=d.fillingEdgeRepetitionCount;break;case"LRBT":e=0,f=a.visualspace.height-d.remainingEdgeSideUnitLength,g=d.fillingEdgeSideUnitLength,h=-1*d.remainingEdgeSideUnitLength,i=d.fillingEdgeRepetitionCount;break;case"RLBT":case"RLTB":console.log("TODO")}b.forEach(function(a,b,j){a.visualspace.width=d.fillingEdgeSideUnitLength,a.visualspace.height=d.remainingEdgeSideUnitLength,a.visualspace.posX=e+g*(b%i),a.visualspace.posY=f+h*Math.floor(b/i),a.visualspace.padding=c.padding})}function x(a,b,c,d){var e,f,g,h,i=0;do i++,h=1*a/i,e=h/d,f=Math.floor(b*i*d/a),g=f*i;while(c>g);return{fillingEdgeRepetitionCount:i,remainingEdgeRepetitionCount:f,fillingEdgeSideUnitLength:h,remainingEdgeSideUnitLength:e}}function y(a){switch(a){case"LRBT":case"LRTB":case"RLBT":case"RLTB":return!0;case"BTLR":case"BTRL":case"TBLR":case"TBLR":return!1}}function z(a){var b,c=a.sizeSharingGroup;switch(a.aspect_ratio){case"square":case"parent":case"custom":return b=d3.scan(c,function(a,b){return a.visualspace.width-b.visualspace.width}),{width:c[b].visualspace.width,height:c[b].visualspace.height};case"maxfill":var d=c.map(function(a){return a.visualspace.width>a.visualspace.height?a.visualspace.height:a.visualspace.width});b=d3.scan(d,function(a,b){return a-b});var e=c.reduce(function(a,b){var c,d,e,f;return a.visualspace.height>a.visualspace.width?(c=a.visualspace.width,d=a.visualspace.height):(c=a.visualspace.height,d=a.visualspace.width),b.visualspace.height>b.visualspace.width?(e=b.visualspace.width,f=b.visualspace.height):(e=b.visualspace.height,f=b.visualspace.width),c>e?b:e==c&&d>f?b:a});return{width:e.visualspace.width,height:e.visualspace.height}}}function A(a,b){var c=B(b.sizeSharingGroup);c.forEach(function(c){var d=C(c,a,b);u(c,c.contents,b,d)})}function B(a){var b=new Set;a.forEach(function(a){b.add(a.parent)});var c=[];return b.forEach(function(a){c.push(a)}),c}function C(a,b,c){var d=Math.floor(a.visualspace.width/b.width),e=Math.floor(a.visualspace.height/b.height);return D(d,e,b.width,b.height,c)}function D(a,b,c,d,e){var f,g,h,i;return y(e.direction)?(f=a,g=b,h=c,i=d):(f=b,g=a,h=d,i=c),{fillingEdgeRepetitionCount:f,remainingEdgeRepetitionCount:g,fillingEdgeSideUnitLength:h,remainingEdgeSideUnitLength:i}}function E(a){"EndOfLayout"!==a&&a.size.isShared===!0&&(F(a),a.sizeSharingGroup=[])}function F(a){switch(a.aspect_ratio){case"fillX":case"fillY":G(a);break;case"square":case"parent":case"custom":case"maxfill":K(a)}}function G(a){var b=I(a);H(b,a)}function H(a,b){var c=B(b.sizeSharingGroup);c.forEach(function(c){switch(b.aspect_ratio){case"fillX":case"fillY":m(c,c.contents,b,a);break;case"square":case"parent":case"custom":case"maxfill":t(c,c.contents,b,a)}})}function I(a){var b=B(a.sizeSharingGroup),c=d3.min(b,function(b){var c=J(b,a),d=p(c,b.contents,a);return d});return c}function J(a,b){switch(b.aspect_ratio){case"fillX":return a.visualspace.width-a.visualspace.padding.left-a.visualspace.padding.right;case"fillY":return a.visualspace.height-a.visualspace.padding.top-a.visualspace.padding.bottom;case"maxfill":case"parent":var c=a.visualspace.width-a.visualspace.padding.left-a.visualspace.padding.right,d=a.visualspace.height-a.visualspace.padding.top-a.visualspace.padding.bottom;return c*d;case"square":var c=a.visualspace.width-a.visualspace.padding.left-a.visualspace.padding.right,d=a.visualspace.height-a.visualspace.padding.top-a.visualspace.padding.bottom;return Math.pow(d3.min([c,d]),2)}}function K(a){if("uniform"===a.size.type){var b=z(a);A(b,a)}else{var c=I(a);H(c,a)}}function L(a,b){var c,d=Q(a,b,"subgroup"),e=R(d);switch(b.subgroup.type){case"groupby":c=O(e,a,b);break;case"bin":c=P(e,a,b);break;case"passthrough":c=M(a,b);break;case"flatten":c=N(a,b)}return c}function M(a,b){return[{contents:a.contents,label:a.label,visualspace:{},parent:a}]}function N(a,b){var c=a.contents.map(function(b,c){return{contents:[b],label:c,visualspace:{},parent:a}});return b.hasOwnProperty("sort")&&c.sort(function(a,c){var d=a.contents[0][b.sort.key],e=c.contents[0][b.sort.key];"numerical"===b.sort.type&&(d=Number(d),e=Number(e));var f="ascending"===b.sort.direction?1:-1;return d>e?f:-1*f}),c}function O(a,b,c){var d=f(a,c.subgroup.key);return d.forEach(function(a,d,e){a.contents=b.contents.filter(function(b){return b[c.subgroup.key]==a.label}),a.parent=b}),d}function P(a,b,c){var d=c.subgroup,e=d3.extent(a,function(a){return+a[d.key]}),f=d3.scaleLinear().domain([0,d.numBin]).range(e),g=d3.range(d.numBin+1).map(f),h=b.contents.filter(function(a){return""==a[d.key]}),i=b.contents.filter(function(a){return""!=a[d.key]}),j=d3.histogram().domain(e).thresholds(g).value(function(a){return+a[d.key]})(i);h=[h],h.x0="",h.x1="";var k=h.concat(j);return k=k.map(function(a){return{contents:a,label:a.x0+"-"+a.x1,visualspace:{},parent:b}})}function Q(a,b,c){return"flatten"===b.type?a:b[c].isShared&&"RootContainer"!==a.parent?Q(a.parent,b.parent,c):a}function R(a){if(S(a)){var b=[];return a.contents.forEach(function(a){var c=R(a);c.forEach(function(a){b.push(a)})}),b}return[a]}function S(a){return a.hasOwnProperty("contents")&&a.hasOwnProperty("visualspace")&&a.hasOwnProperty("parent")?!0:!1}function T(a,b,c,d){var e=b.layouts,f=b.mark,g=d3.select("#"+d).append("svg").attr("width",b.width).attr("height",b.height),h=g.selectAll(".root").data([a]).enter().append("g").attr("class","root").attr("transform",function(a){return"translate("+a.visualspace.posX+", "+a.visualspace.posY+")"}),i=h;switch(e.forEach(function(a){var c=i.selectAll("."+a.name).data(function(a){return a.contents}).enter().append("g").attr("class",a.name).attr("transform",function(a){return(isNaN(a.visualspace.posX)||isNaN(a.visualspace.posY))&&(console.log("NaN happened"),console.log(b)),"translate("+a.visualspace.posX+", "+a.visualspace.posY+")"});c.append("rect").attr("x",0).attr("y",0).attr("width",function(a){return a.visualspace.width}).attr("height",function(a){return a.visualspace.height}).style("opacity",function(b){return a.hasOwnProperty("box")&&a.box.hasOwnProperty("opacity")?a.box.opacity:$.layout.box.opacity}).style("fill",function(b){return a.hasOwnProperty("box")&&a.box.hasOwnProperty("fill")?a.box.fill:$.layout.box.fill}).style("stroke",function(b){return a.hasOwnProperty("box")&&a.box.hasOwnProperty("stroke")?a.box.stroke:$.layout.box.stroke}).style("stroke-width",function(b){return a.hasOwnProperty("box")&&a.box.hasOwnProperty("stroke-width")?a.box["stroke-width"]:$.layout.box["stroke-width"]}),i=c}),f.shape){case"circle":var j=i.append("circle").attr("cx",function(a){return a.visualspace.width/2}).attr("cy",function(a){return a.visualspace.height/2}).attr("r",function(b){return V(b,a,f,c)}).style("fill",function(a){return"purple"});break;case"rect":var j=i.append("rect").attr("x",function(a){return 0}).attr("y",function(a){return 0}).attr("width",function(a){return a.visualspace.width}).attr("height",function(a){return a.visualspace.height}).style("fill",function(a){return"purple"});break;default:console.log("You should not see this")}U(j,a,f,c)}function U(a,b,c,d){var e;Y(b,d.head);"categorical"===c.color.type?e=d3.scaleOrdinal(d3.schemeCategory10):console.log("TODO"),a.style("fill",function(a){return e(a.contents[0][c.color.key])})}function V(a,b,c,d){var e;return e=c.size.isShared?X(a,b,c,d):W(a,c)}function W(a,b){var c=a.visualspace.width,d=a.visualspace.height;return"max"===b.size.type?c>d?d/2:c/2:void 0}function X(a,b,c,d){var e=Y(b,d.head);return d3.min(e,function(a){return W(a,c)})}function Y(a,b){if("EndOfLayout"!==b.child){var c=[];return a.contents.forEach(function(a){var d=Y(a,b.child);d.forEach(function(a){c.push(a)})}),c}return a.contents}var Z=function(b,e){d3.csv(e.data,function(f,g){try{console.log(JSON.stringify(e))}catch(h){console.log(h)}g.forEach(function(a,b){a.id=b});for(var i=c(g,e),j=d(e.layouts),k=[i],l=j.head;"EndOfLayout"!==l;)k=a(k,l),l=l.child;T(i,e,j,b)})},$={layout:{box:{fill:"blue",stroke:"black","stroke-width":1,opacity:.03}}};return{UnitChart:Z}}),angular.module("unitApp").controller("LiveCtrl",["unit",function(a){var b=a.UnitChart;d3.json("./data/fluctuation.json",function(a,c){b("editorchart",c)});var c=document.getElementById("jsoneditor"),d={},e=new JSONEditor(c,d);d3.json("./data/fluctuation.json",function(a,b){e.set(b)});var f=d3.select("#updatebutton");f.on("click",function(){var a=e.get();console.log(a),d3.select("#editorchart").select("svg").remove(),b("editorchart",a)})}]),angular.module("unitApp").controller("EnumCtrl",["unit",function(a){function b(a,b,c){var d=[];return a.forEach(function(a){b.forEach(function(b){c.forEach(function(c){var e=JSON.parse(JSON.stringify(a)),f=JSON.parse(JSON.stringify(b)),g={title:"Titanic",data:"data/titanic3.csv",width:1e3,height:320,padding:{top:5,left:5,bottom:5,right:5},layouts:[]};g.layouts=[e,f],g.mark=c,d.push(g)})})}),d}function c(a,b,c,d,e){var f=[];return a.forEach(function(a){b.forEach(function(b){c.forEach(function(c){d.forEach(function(d){var e=JSON.parse(JSON.stringify(a)),g=(JSON.parse(JSON.stringify(c)),JSON.parse(JSON.stringify(b))),h={title:"Titanic",data:"data/titanic3.csv",width:1e3,height:320,padding:{top:5,left:5,bottom:5,right:5},layouts:[]};h.layouts=[e],h.layouts=h.layouts.concat(g),h.layouts=h.layouts.push(g),h.mark=d,f.push(h)})})})}),f}function d(a,b){var c=[];return a.forEach(function(a){b.forEach(function(b){var d={title:"Titanic",data:"data/titanic3.csv",width:1e3,height:320,padding:{top:5,left:5,bottom:5,right:5},layouts:[]};d.layouts.push(a),d.mark=b,c.push(d)})}),c}function e(a,b){d3.select("#"+b).selectAll("div").data(a).enter().append("div").attr("id",function(a,b){return"enum"+b}),a.forEach(function(a,b){m("enum"+b,a)})}function f(a){var b=["fillX","fillY","maxfill","square","parent"],c=["uniform"],d=[!0,!1],e=["LRTB"],f=["LB"],g=a,h=[];return b.forEach(function(a){c.forEach(function(b){d.forEach(function(c){e.forEach(function(d){f.forEach(function(e){g.forEach(function(f){var g={name:"flattenLayer",type:"gridxy",subgroup:{type:"flatten"},aspect_ratio:a,size:{type:b,isShared:c},direction:d,align:e,margin:{top:0,left:0,bottom:0,right:0},padding:{top:0,left:0,bottom:0,right:0},box:{fill:"yellow",stroke:"red","stroke-width":0,opacity:.1},sort:{type:j(f)?"categorical":"numerical",key:f}};h.push(g)})})})})})}),h}function g(a){var b=["fillX","fillY","maxfill","square","parent"],c=a,d=[!0],e=[{type:"uniform"},{type:"count"}];e=e.concat(a.map(function(a){return{type:"sum",key:a}}));var f=[!0],g=["LRTB"],h=["LB"],i=a,k=[];return b.forEach(function(a,b){e.forEach(function(b){f.forEach(function(e){g.forEach(function(f){h.forEach(function(g){i.forEach(function(h){c.forEach(function(c){d.forEach(function(d){var i={name:"firstlayer",type:"gridxy",subgroup:{type:"groupby",key:c,isShared:d},aspect_ratio:a,size:{type:b.type,isShared:e,key:"sum"===b.type?b.key:""},direction:f,align:g,margin:{top:0,left:0,bottom:0,right:0},padding:{top:0,left:0,bottom:0,right:0},box:{fill:"yellow",stroke:"red","stroke-width":0,opacity:.1},sort:{type:j(h)?"categorical":"numerical",key:h}};k.push(i)})})})})})})})}),k}function h(a,b){var c=["fillX","fillY","maxfill","square","parent"],d=[{type:"passthrough"}];d=d.concat(a.map(function(a){return{type:"groupby",key:a}}));var e=[!0],f=[{type:"uniform"},{type:"count"}];f=f.concat(a.map(function(a){return{type:"sum",key:a}}));var g=[!0],h=["LRTB"],k=["LB"],l=a,m=[];return c.forEach(function(a,b){f.forEach(function(b){g.forEach(function(c){h.forEach(function(f){k.forEach(function(g){l.forEach(function(h){d.forEach(function(d){e.forEach(function(e){var i={name:"firstlayer",type:"gridxy",subgroup:{type:d.type,key:"groupby"===d.type?d.key:"",isShared:e},aspect_ratio:a,size:{type:b.type,isShared:c,key:"sum"===b.type?b.key:""},direction:f,align:g,margin:{top:0,left:0,bottom:0,right:0},padding:{top:0,left:0,bottom:0,right:0},box:{fill:"yellow",stroke:"red","stroke-width":0,opacity:.1},sort:{type:j(h)?"categorical":"numerical",key:h}};m.push(i)})})})})})})})}),m=i(m,b-2)}function i(a,b){if(1==b)return a;var c=i(a,b-1),d=[];return a.forEach(function(a){c.forEach(function(b){aCopyLayer=JSON.parse(JSON.stringify(a));var c=[aCopyLayer];aNewCopyLayer=JSON.parse(JSON.stringify(b)),c=c.concat(aNewCopyLayer),d.push(c)})}),d}function j(a){var b=["age","fare"];return-1==b.indexOf(a)?!0:!1}function k(a){var b=a,c=[!0,!1],d=[!0],e=["circle","rect"],f=[];return b.forEach(function(a){c.forEach(function(b){d.forEach(function(c){e.forEach(function(d){var e={shape:d,color:{key:a,type:j(a)?"categorical":"numerical",isShared:c},size:{type:"max",isShared:b},isColorScaleShared:!0};f.push(e)})})})}),f}d3.csv("./data/titanic3.csv",function(a,b){var c=Object.keys(b[0]);d3.select("#control_enumeration").selectAll("input").data(c).enter().append("label").attr("for",function(a,b){return"a"+b}).text(function(a){return a}).append("input").property("checked",function(a,b){return!1}).attr("type","checkbox").attr("id",function(a,b){return"a"+b})});var l=d3.select("#updatebutton_enumeration");l.on("click",function(){var a=d3.select("#control_enumeration").selectAll("input");console.log(a);var b=[];a.each(function(a,c){d3.select(this).property("checked")&&b.push(a)});var c=d3.select("#nLayer").property("value");c=+c,console.log(b),n(b,c,"unit_enumerate")});var m=a.UnitChart,n=function(a,i,j){d3.json("./data/enumerate.json",function(l,m){var n,o,p=[];switch(i){case 1:n=f(a),o=k(a),p=d(n,o);break;case 2:var q=g(a);n=f(a),o=k(a),p=b(q,n,o);break;default:var q=g(a),r=h(a,i);n=f(a),o=k(a),p=c(q,r,n,o)}console.log("Number of Enumerations:",p.length),d3.select("#num_enumeration").text(p.length),d3.select("#enumerate_draw").property("checked")||e(p,j)})}}]),angular.module("unitApp").run(["$templateCache",function(a){a.put("views/enum.html",'<h1> Enumeration </h1> Select variables you want to enumerate <div id="control_enumeration"> </div> <label for="nLayer"> Number of Layers = <span id="nLayer-value"></span> </label> <input type="number" min="1" max="5" step="1" value="1" id="nLayer"> <label><input type="checkbox" checked id="enumerate_draw">Don\'t actually draw, just calculate </label> <div id="update_enumeration"> <input id="updatebutton_enumeration" name="updateButton_enumeration" type="button" value="Update enumeration"> </div> <p> Numer of enumeration: <div id="num_enumeration"></div> <div id="unit_enumerate"></div></p>'),a.put("views/example.html",'<h3>Unit Column Chart </h3> Layout1 class fillX Layout2 id packXY  By setting the size.isShared for second pack layout, we can create absolute version and relative percentage version. <a href="data/unit_column_chart_shared.json">JSON for Left </a> <a href="data/unit_column_chart.json">JSON for Middle</a> <a href="data/unit_column_chart_shared_mark.json">JSON for Right</a> <div class="container"> <div id="unit_column_chart_shared" class="fixed"> </div> <div id="unit_column_chart" class="fixed"> </div> <div id="unit_column_chart_shared_mark" class="flex-item"> </div> </div>  And you can create horizontal unit column chart. In this case Layout1 is fillY and Layout2 is packxy ,direction=BTLR.  <a href="data/horizontal_unit_column.json">JSON for chart </a> <div id="horizontal_unit_column"></div> <h3>Hierarchical Sharing </h3> Layout1 class fillX Layout2 gender fillY Layout3 id packXY  These sharing settings are hierarchical meaning that each level can have its own sharing configuration on/off and these affect to what extent the domain is shared.  <a href="data/titanic_spec_packxy_isolated.json">JSON for Top Left (Layout2: True, Layout3: True )</a>  <a href="data/titanic_spec4.json">JSON for Top Right (Layout2: True, Layout3: False )</a>  <a href="data/titanic_spec_packxy_hierarchy.json">JSON for Bottom Left (Layout2: False, Layout3: True)</a>  <a href="data/titanic_spec_packxy_mixed.json">JSON for Bottom Right (Layout2: False, Layout3: False)</a>  <div class="container"> <div id="packxy_isolated" class="fixed"> </div> <div id="packxy2" class="flex-item"> </div> </div> <div class="container"> <div id="packxy_hierarchy" class="fixed"> </div> <div id="packxy_mixed" class="flex-item"> </div> </div> <h3>Maxfill aspect_ratio </h3> Layout1 age PackXY Layout2 class fillX Layout3 packXY  The square aspect_ratio can lead to the empty space. To resolve this, \'maxfill\' aspect ratio try to find the an optimal aspect ratio that is close to square while removing empty space.  <a href="data/square_aspect.json">JSON for Top (Layout3: aspect_ratio:square)</a>  <a href="data/maxfill_aspect.json">JSON for middle (Layout3: aspect_ratio:maxfill )</a>  <a href="data/unit_small_multiple.json">JSON for Bottom (Layout3: aspect_ratio:maxfill isShared is true for Layout2 and Layout3)</a>  <div> <div id="square_aspect"> </div> <div id="maxfill_aspect"> </div> <div id="unit_small_multiple"> </div> </div> <h3>Size by function </h3> Layout1 class fillX Layout2 fillY  "size": { "type": ""sum", "key": "fare"", "isShared": true },  Size can be function of the contents. In top left, size is uniform for layout2. In top right, size is a function of sum of fares. In both, case size is not shared  These setting can be combined with "isShared" flag. In bottom left, size is uniform and shared, and in bottom right, size is function of sum of fares and is shared. You can use the following syntax. Here the type can be sum, count, or uniform. If it is sum, it can have additional "key" parameter which will determine the variables for sum.  "size": { "type": ""sum", "key": "fare", "isShared": true },  <a href="data/size_uniform_notShared.json">JSON for Top Left (Layout2: {"size": {"type":"uniform", "isShared":false}} )</a>  <a href="data/size_sum_notShared.json">JSON for Top Right (Layout2: {"size": {"type":"sum", "key":"fare", "isShared":false}} )</a>  <a href="data/size_uniform_shared.json">JSON for Bottom Left (Layout2: {"size": {"type":"uniform", "isShared":true}} )</a>  <a href="data/size_sum_shared.json">JSON for Bottom Right (Layout2: {"size": {"type":"sum", "key":"fare", "isShared":true}} )</a>  <div class="container"> <div id="size_uniform_notshared" class="fixed"> </div> <div id="size_sum_notshared" class="flex-item"> </div> </div> <div class="container"> <div id="size_uniform_shared" class="fixed"> </div> <div id="size_sum_shared" class="flex-item"> </div> </div> <h3>Violin Plot </h3> <p> Layout1 class fillX </p><p> Layout2 fillY size uniform, isShared:true  </p><p> Layout3 fillX size count, isShared:true  </p><p> Layout4 maxfil size uniform, isShared:false  </p><p> <a href="data/violin.json">JSON for Unit Violin chart</a>  <div id="violin"></div> <h3>Unit Fluctuation Chart </h3> </p><p> Layout1 gender fillY </p><p> Layout2 class fillX size uniform, isShared:true  </p><p> Layout3 passthrough size count, isShared:true  </p><p> Layout4 maxfil size uniform, isShared:false  <a href="data/fluctuation.json">JSON for Unit Fluctuation chart</a>  <div id="fluctuation"></div> <h3>Mosaic Plot </h3> </p><p> Layout1 class fillY, size:count </p><p> Layout2 survived fillX size:count, isShared:false  </p><p> Layout3 sex fillY size count, isShared:false  </p><p> Layout4 maxfill size uniform, isShared:false  <a href="data/mosaic.json">JSON for Mosaic plot</a>  <img src="images/vcd-mosaic.90790bfb.png"> <div id="mosaic"></div></p>'),a.put("views/live.html",'<h1> Edit json and press update button </h1> <div id="editorchart"></div> <div id="update"> <input id="updatebutton" name="updateButton" type="button" value="Update"> </div> <div id="jsoneditor" style="width: 400px; height: 400px"></div>'),a.put("views/main.html",'<div class="jumbotron"> <h3>Unit Visualization Grammar</h3> <p class="lead"> <img src="images/process.98b7fb36.png" width="600" alt="I\'m Yeoman"><br> Atom: Unit Visualization Grammar </p> </div> <div class="row marketing"> <h4>Examples</h4> <p>Examples of Atom Grammar </p> <h4>Live Editor</h4> <p>Here you can change json specification in editor and see its effect</p> <h4>Enumerator</h4> <p>Calculate the number of enumeration given dataset</p> </div>')}]);